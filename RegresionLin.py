import numpy as np
import pandas as pd
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import io
import base64
from sklearn.linear_model import LinearRegression

data = {
   "Inversión en publicidad (USD)": [66.54419200263513, 96.82764087363226, 88.0911532640561, 55.42418557372727, 76.88017631344871, 25.84717781368441, 23.0739257037336, 87.13392517504955, 66.69655368188577, 18.5644919207882, 15.80158116215992, 89.2674329897756, 82.00132991555687, 90.22068135572974, 44.20548575232507, 84.48316389926447, 37.87378566424425, 66.01010652512048, 91.75895127759355, 93.6952147572775, 92.22994694689223, 23.94382858242911, 77.81353031355992, 33.2193061443048, 70.26446321509763, 54.52163772424577, 59.40722634293743, 21.78415683874367, 93.2244417779184, 98.73332115744492, 69.15649453221323, 67.73083025679838, 82.75600187064747, 32.28809585164414, 46.40565355321677, 68.84697478144064, 18.55698199601648, 62.55538140345286, 65.17954402393796, 67.88595195660378, 71.27024118319457, 18.67538534842677, 16.79311923764437, 85.33368742541784, 64.96006494061135, 82.5421969061151, 35.72435129182308, 81.44452518141702, 65.00399631018578, 61.27290965556807, 47.9906235070251, 80.88048765288336, 77.96006331054645, 38.88855087945113, 82.23491035525475, 18.58662797583996, 67.80946834627778, 11.84271355872734, 95.77233741640379, 50.70072700657055, 45.58291314752938, 53.28315503614608, 22.53850293995247, 95.65739170864636, 22.80640664186634, 58.61000754628584, 92.91766045912777, 40.3199519790195, 79.19198606335742, 40.4392721496358, 61.02941706579612, 43.2536886889545, 33.04115256082008, 92.16175318553654, 44.24109942089114, 38.15475309228457, 48.86784981709703, 21.59077125130775, 77.86384205709764, 60.90512224226138, 29.65583366864631, 33.96522838536994, 20.07816175841893, 89.96371266349047, 83.71017005564639, 94.22220234251567, 82.93928591806063, 52.66725641577402, 68.83954608296473, 89.92134708407362, 68.59973447710384, 68.62774698503146, 16.76615018634129, 79.61227219547852, 17.42883956683652, 44.15431691706767, 95.58536572539494, 33.64520803755682, 35.50010987043471, 88.72457776512019, 90.27217879065729, 47.37947790660915, 75.8153300748901, 14.8363311710204, 62.17158342324635, 98.80611738550263, 69.61699902575907, 53.36327422706734, 37.19952917769753, 68.89801746508924, 50.50709322308067, 16.3248831835265, 38.27263252101453, 32.49578204424478, 64.8145818803025, 10.25786297761586, 83.39020773623267, 78.31939759947514, 90.56627232024564, 77.24621622418043, 83.83669236720988, 63.40416910639944, 40.79677304492218, 69.56796732866269, 20.77912709543466, 19.18330807042439, 48.00446428761745, 19.2618694668158, 64.02237912013675, 11.75677098226888, 13.44556455307115, 83.05701637608357, 26.7917877106876, 23.80463713497402, 17.8071154808778, 34.86256007259514, 64.07485514255583, 67.58431881864558, 95.75027010273249, 75.56910272527537, 57.47355053023617, 74.69701800300382, 12.74315818992511, 21.04700481961591, 87.25252120698931, 46.75353274492515, 15.43118413181256, 57.36793060525063, 26.12010685702414, 65.43495566412105, 91.44546707435282, 31.29019899830413, 99.28278221681244, 86.20121243520677, 51.12025348484418, 39.10347300735808, 80.03918927613945, 80.42632890531706, 56.36414412148208, 65.95178481541697, 18.36244906914662, 93.74039820712926, 36.71813693686958, 69.6657024412475, 15.72169554169036, 66.4706628161255, 31.22463008274121, 95.5749339064395, 64.79470901044459, 18.24024902496051, 49.96669867443706, 59.61528005153917, 45.21526360826961, 39.44102195827321, 55.69869830800958, 43.81246676011575, 39.55638093709645, 18.7780444362533, 76.26064318871192, 13.63885769658388, 65.9208609605065, 67.3418487225534, 49.54198908955738, 94.48240695780554, 21.22654451097117, 16.23194529112604, 34.531870616201, 11.26512483449185, 99.74204775725019, 12.03467400136425, 33.13357607350304, 52.27852920034544, 63.9007050501038, 25.31785063286972, 53.23109991157871, 71.38136701789092, 53.77323389464109, 37.87005405621149, 23.24503188763133, 47.66886170760854, 28.10729735422029, 70.55606232404455, 44.18974930741769, 64.35223887756032, 82.43277030839984, 27.72944299591904, 90.14763786886132, 93.35157536234289, 99.06977462257375, 95.53922930386152, 92.75580248458554, 67.48494067390703, 51.28536648756955, 71.00443230172151, 25.16356869376887, 94.23368411122614, 39.87556499359499, 40.23163023722934, 16.78942782374313, 95.82702806459417, 22.20881576361803, 86.91665524744863, 33.14795823561126, 20.59782121127111, 15.89330945657919, 66.68633008482345, 17.03040355891693, 55.37378752476582, 76.24589386036047, 20.08971228335544, 72.23262457912354, 85.95132461311447, 46.24646005716353, 28.24963431987627, 18.11088468560083, 23.26372298323536, 76.20610156521187, 54.23211945403251, 34.48422361291655, 58.81466679794188, 62.71061528561697, 50.45407330016263, 96.03408043375101, 90.84591873282862, 44.11339501123254, 69.96163342571239, 31.63193124931403, 52.06218524580181, 65.37652478190059, 90.64949158248189, 36.32750401494069, 22.06438935342798, 51.12609217859946, 86.28996543188813, 69.12535955309521, 81.53703205721507, 81.63010405451803, 43.58869605163003, 87.9298802751359, 19.82174879870592, 28.03367746609795, 51.6993083415836, 47.73389202001533, 39.8156095119418, 75.35049583454497, 24.69752475549972, 58.81145951411014, 78.3013672022288, 51.87557099676327, 80.27672985768402, 93.8024254316705, 26.21888604118845, 73.40180736641196, 45.35879284871643, 32.23222249926806, 69.25872562472186, 70.77629065285846, 29.25038099010168, 57.30572666165984, 12.53697605971666, 60.29199317297566, 12.91101769390743, 57.06720294249819, 61.93858781131119, 92.5215377445139, 77.34105569068129, 70.70297408981024, 24.65647586039572, 46.11031384050303, 30.25663962332596, 40.22072737454383, 29.07614093978963, 94.79360139301572, 73.07720210090082, 10.20270430143104, 90.67762890655251, 82.70723544218362, 74.31915857607103, 73.08511012143802, 48.42205883085958, 16.67690879749543, 87.11416463697459, 32.92663636297659, 28.20297869491958, 56.21596820654695, 30.10718263072935, 68.57250393829139, 80.95126188183535, 11.16394114117103, 30.69528465463775, 17.06859982853933, 68.8909643727938, 33.58685861762812, 39.20610016542838, 88.20758478585805, 30.32612576547194, 75.68537169833422, 97.96656082436681, 59.21480290487602, 94.2486211212335, 86.31215013832994, 49.12521470942524, 38.03349549051303, 87.53489530681054, 91.00770382515364, 68.26025679699873, 39.26236113285447, 99.63876741799331, 43.07203346430049, 64.78961199263603, 85.51109441598489, 81.08880282318891, 31.63034727651774, 60.08019304812873, 97.89473511940518, 53.88100881529958, 82.93662878592275, 98.22989234281624, 51.81905591775914, 23.76869421771699, 31.38485235161632, 70.13362764238067, 12.09352576956399, 55.23932870302971, 95.055954792644, 49.41121565086733, 88.55451733981548, 89.42514441070266, 66.66486233316746, 13.91946602123619, 85.13360179818388, 38.55404644326804, 57.2826035796265, 78.66829617523864, 70.15904187956102, 11.28255413411655, 40.81844786944943, 88.05855249665515, 44.27559852523738, 20.39974578973984, 61.37468855433511, 86.60252649221405, 46.86480569657616, 45.45033175127598, 13.48917667964196, 75.30317014219325, 61.43512647231621, 71.84715499908634, 67.20721327065995, 54.62104284112922, 58.53009690332355, 98.11906356656927, 53.3190660218872, 75.97934751342815, 30.02106056562746, 58.50488376321112, 25.42993922238859, 56.5676122778212, 61.96231416970089, 60.78196802883003, 39.83490028040873, 80.61203838939963, 46.51898167038347, 86.51578928108829, 58.88344677741015, 57.22486777818198, 91.67245076049296, 93.11472253169359, 72.74332448542192, 36.183067899695, 81.82475279660864, 75.39093079940318, 55.41448187781668, 24.17413781748118, 19.60154055570733, 35.02994143737615, 79.10086282403687, 76.40258023880708, 46.98857247132685, 59.34954632229429, 77.94249769914985, 56.98033541884164, 97.95017517369307, 80.62673593919799, 84.33060690016708, 56.68277227567643, 95.99038506766195, 23.14785617684812, 76.48251783383644, 77.75437620217848, 72.97493853583023, 92.17150297142605, 50.37589275874465, 13.21764828178845, 97.44109229930689, 93.34981881042066, 23.32167382154805, 78.38141376928105, 90.13030379821062, 34.2702877553916, 49.73005079976641, 11.40212132566645, 11.85107462634491, 81.72356807758867, 79.80593297854284, 17.90004228286366, 37.76057201259411, 14.03846085987335, 14.1073496378107, 70.95232302626032, 77.40841034872854, 63.34525357895986, 30.76390474327282, 24.77169225230125, 35.26395491595675, 68.23827538131873, 64.85837145284856, 47.3785567259976, 57.3245284269951, 57.20051004186769, 48.13391340785135, 67.49725525601121, 70.04037161817452, 25.57764883786473, 62.87035502383093, 77.31303218064096, 88.88963132958743, 27.35021759205583, 77.60565168447421, 85.20612835656625, 40.03961548243232, 28.88897447540037, 89.02092533781835, 21.3995524952108, 96.42650156863324, 57.46912021715964, 94.46061028678007, 60.13761192141274, 72.69037331104516, 86.06621892311736, 46.99667614396624, 21.04200066220974, 33.5283183037326, 16.78627561183653, 50.97996284082959, 54.31712552758504, 73.0633080921867, 87.29341297567986, 37.49609139185746, 99.62412569388556, 71.94818264541257, 99.18585083678185, 53.5056524962671, 67.04856858468744, 54.70800963384192, 51.21704810616019, 39.24433820428195, 37.35033935178762, 82.62734187137833, 62.99074527228182, 58.7469131374726, 10.92877459441426, 62.25722879808995, 52.74966326413922, 70.48143745921027, 69.63847076681691, 63.28205508143353, 23.62727820469183, 59.81957853150401, 19.32949548102494, 44.75504722668812, 94.85484903015957, 85.19640767808552, 97.69277796184947, 94.55518517450052, 52.35369834232333, 69.37980170241407, 26.02037842752437, 74.90415600852045, 49.36117807937026],
"Ventas (unidades)":[259.9367114682429, 382.4237994902358, 339.2360185265255, 214.8538502040645, 301.518054908835, 108.2502636488931, 97.43403820749643, 332.3446669794763, 255.8710724101569, 82.16813532098453, 71.94380002966564, 349.0542854300713, 313.7455381134487, 336.8825254364893, 176.3828638813386, 325.9640496996189, 151.640393683684, 254.9397633679863, 352.1552365323947, 350.0706618309915, 349.7521185094218, 99.48385232883433, 311.8511622679463, 125.4647769450086, 272.6611744516599, 218.0413673135326, 231.4540787063684, 90.97437019849936, 355.479509004711, 382.0853846435763, 273.3269378581947, 259.8185273009798, 316.4916453754875, 125.8689244991807, 178.7303965154481, 267.4429740713283, 74.93465506935013, 241.1252562145665, 251.102770845796, 258.349372658652, 276.1260913322394, 77.68302859473269, 72.89328595667706, 340.3403107322599, 254.4941747397684, 318.0205390367565, 149.5926678444902, 312.363510436175, 259.7365938832075, 239.7395951085091, 194.9358932772695, 309.5072920130374, 302.6137533173726, 156.5015531569642, 314.3323914284292, 82.26759597535964, 260.78395558536, 60.89102764016629, 363.955591636415, 194.6645415363224, 174.6668143269509, 207.0148014256702, 106.192106896028, 357.3759159011095, 96.24550191109529, 227.5288307788204, 365.8639282547871, 160.3165315407734, 302.5118173172846, 159.505002330586, 237.4415982643032, 174.5286475645245, 139.5723893902655, 360.1245702234411, 177.1242428449235, 155.8342831165859, 195.0515210150484, 86.63460408705359, 305.3433024004112, 239.4121922301201, 124.5512624431689, 141.8187221182361, 90.78073119772753, 353.1294289902277, 328.6277165422906, 363.7932373036576, 317.2809873807366, 216.9634951310956, 271.5339801274385, 342.2018786553163, 269.6255532925318, 275.262665959065, 63.2820933106428, 306.8812488118651, 74.04882486285686, 174.0753498071431, 368.7575624205728, 139.0578148946874, 142.3773749314276, 348.3446636132704, 354.6603615120133, 190.8072975876872, 295.5365986436108, 71.3683465851239, 241.2834225796553, 389.6472674821444, 272.3808929436561, 204.7928385394559, 145.0922161508738, 273.7248988529035, 200.9694939746429, 76.95563662961938, 154.2854350510632, 130.4476936404993, 253.5343151857047, 50.3305951973324, 331.3738102144907, 299.6641453191663, 352.7507197151563, 300.7615087264012, 329.5568297188639, 247.8322983886081, 163.2965164595024, 270.8106016306854, 85.94496341175613, 83.58169334340617, 193.5750060630184, 87.31150834372784, 248.2440468236699, 60.07391164243382, 57.96242368786864, 318.3435610828838, 106.7379993002831, 92.57584901685571, 79.86553777841988, 134.3099467063426, 248.502896779797, 259.1406506802143, 370.6057155761725, 294.5356968749168, 216.12183456757, 301.4450744924727, 65.64740200608881, 94.4619821879374, 334.169790992458, 180.5970485119239, 67.13186196283019, 226.49701398354, 111.5985994618037, 251.3483101783641, 351.8468581119241, 134.4558816040703, 386.7773982938024, 335.756799760643, 195.3590445661158, 158.8827419751162, 313.1384617159761, 312.5145404052548, 219.2901805185112, 251.2408144276683, 76.78505120329581, 368.2693291213125, 149.2425907960595, 274.2184492779637, 69.93069139151734, 260.2434996192595, 118.5066701919633, 364.1017715369984, 257.7978509266772, 76.18024067849139, 194.047383698691, 236.77692662591, 178.468916656654, 153.4043968798527, 218.6080743344246, 174.6321120147631, 159.1525042929651, 76.80741166369766, 290.5712111178257, 63.77247404156984, 262.5006431748457, 276.2423814098448, 195.0436580035673, 362.6928516242549, 96.25745940028632, 65.51905049042145, 141.1523211396845, 45.54157138940081, 382.8756046475144, 54.0520215804268, 133.3462030670093, 210.1688758523527, 256.3617638548063, 97.76968026128552, 193.9645189018691, 283.1750249146942, 207.1429264864936, 159.1823848246208, 96.39262258588977, 192.4555881370113, 118.0636590525913, 272.8537734746972, 177.990247778983, 256.7435448221451, 317.0270482914771, 111.5820763267858, 338.5478349413743, 363.9463920092205, 378.3312506559735, 365.6828634638294, 354.3616482256388, 261.6871288403314, 192.0234700762482, 276.0607078234821, 99.82139942096386, 345.947319667117, 155.0074138129545, 169.6645094212873, 74.05501909696316, 369.2769754014852, 92.64058970640644, 330.8732942918032, 136.5488273197446, 84.03175508017331, 66.80499045766697, 260.4965562842856, 69.50622184635671, 221.0758683329255, 291.3368836869722, 85.9194356091528, 287.7619512891356, 333.4490812021107, 189.2327769040582, 115.616170260308, 75.35254782529152, 100.818618627098, 295.1867467211166, 211.7765990222196, 149.2678737905455, 232.5640694756871, 235.4725309650766, 201.404666504084, 371.5012903290967, 353.2845773133541, 166.0751362750499, 274.6603477366342, 125.5386405658207, 204.0762537560552, 248.9216851755779, 352.0479362411787, 146.0835771161981, 85.84494462507323, 200.4274835905564, 331.5822911851763, 273.1510309339028, 310.979651533563, 317.6104751513059, 178.5382776883819, 339.7886222059192, 88.66613562008135, 117.6894442996033, 205.5690815782658, 183.5492850199501, 156.067410503286, 289.0566794660051, 102.627042269183, 230.4014034016239, 313.331718999879, 208.7956971126002, 311.9982551359113, 355.1842485588413, 113.1517108703983, 284.0918561000973, 179.4173699564404, 126.1761247794889, 264.4785957379562, 267.1991821580476, 117.82109838415, 225.1996577864364, 59.85840949962546, 240.0168380747549, 51.15995012501665, 224.9783394400443, 243.9861166046443, 347.8727549245605, 300.0730766315767, 271.7543163157247, 106.8487354308442, 180.5996348634877, 123.0780163939624, 169.0255711654514, 121.4590776252623, 366.160561544024, 275.2595516187141, 54.38324114573141, 349.4042938313685, 316.366934692952, 286.9014660281124, 288.1966941780448, 182.2560704061444, 74.33695753339127, 339.3734466547371, 136.6396561902623, 129.5034598980426, 218.8964354031857, 132.3506137848495, 256.6427859314049, 315.2409158173643, 51.60309525926404, 120.5038775829995, 72.33349745246323, 269.4973197886723, 135.2089408688208, 153.933493582147, 336.4963516588385, 126.0518716133754, 295.932227698092, 373.794738591014, 230.5332946302372, 369.024381809666, 323.5749753283172, 199.5529967864557, 158.8253974492924, 339.5802358992387, 353.4764704147547, 263.5227864060073, 160.3858600563212, 386.2822203780498, 182.3531404220604, 247.8852575154501, 333.1665767537596, 315.481986683475, 129.3846239159621, 228.052548789026, 381.4602022062522, 207.6371567951589, 316.4365688037669, 377.9026745896195, 195.9289381010256, 105.7349902230902, 130.5608868626916, 260.7267457173583, 61.34853946788698, 214.3634169906788, 366.22354126202, 194.0882329717373, 342.9891624480329, 343.6180952706461, 257.5952534939101, 64.2360534040258, 323.5159654248436, 149.7652285857766, 218.5012055040183, 302.3851513227606, 266.2186173915861, 57.33783197704464, 161.0554465412559, 339.5308966099494, 172.060576685582, 76.27722727201198, 238.7258026304551, 340.1411950069808, 187.8593006020893, 179.2314120649911, 64.89800293849031, 291.3182542937761, 231.0649076376635, 272.4675817558052, 258.6228405751207, 215.2172760356288, 216.3985523391347, 373.7431330191898, 199.0920368817729, 296.3371232780199, 124.1244442756423, 224.1438771216067, 102.039556917908, 229.8835141861979, 244.1448491993514, 236.5887742232368, 170.857543756943, 310.1939107361443, 183.1391745764402, 333.9281134300611, 238.8685060083299, 234.3676573201555, 359.9343881443158, 362.0393295583459, 284.647796850309, 143.008916478938, 315.6292235230489, 295.3259255116486, 211.1855781493812, 101.2685169667245, 89.33812993678016, 145.2351098080062, 306.0294280133936, 289.5854323243086, 185.9757932727599, 230.468160516431, 305.9375149819531, 231.7001208806131, 381.4091449145089, 307.5101743854149, 320.7918772367477, 219.944082610906, 371.1456590904027, 95.58624300381102, 305.8588569479948, 300.3672666138784, 288.4025512432202, 352.2157833658218, 201.0871345944998, 63.71689379013136, 376.776098376562, 358.3205490836282, 94.32479173851078, 299.8310197834149, 347.0751903302622, 140.6869160735576, 196.0892611780671, 50.91630678049894, 52.44532627306003, 312.2031396017662, 305.9583689734755, 70.94663765604282, 151.3650040171871, 48.20888323801346, 64.15139599808948, 279.323263129615, 296.4159844594436, 244.7461931151631, 119.0405802383793, 112.55394766228, 132.3662273692197, 266.3887584556545, 258.1461396085342, 195.5141044196195, 217.7263816201373, 227.6187857466404, 198.0415104590345, 257.6756106589731, 274.6146203822074, 107.3474613194166, 238.594618209919, 297.2013327530083, 340.8224700023445, 116.2972230993392, 304.6313753020402, 329.5993323437035, 162.8593121382875, 112.013108470181, 343.3662808899795, 90.38460793455454, 373.5910820957708, 225.5482794404037, 361.0162051918505, 242.2820343185473, 286.123196462927, 333.1655548875877, 190.4541373729022, 95.37475225236861, 134.7268449175769, 67.54709943123129, 193.0524449976586, 220.725615833877, 277.2301425333409, 333.9099143933088, 154.8611308840446, 385.0402029189802, 278.4690493449102, 379.0292283046246, 207.4384658640111, 267.8066330994896, 205.8418749355367, 212.6796637547456, 157.9985156751914, 155.2308972257632, 314.3724797815738, 244.322699907812, 234.4230057489998, 53.11562413059815, 248.7431526092174, 209.150313601255, 284.5969504052751, 282.251131920041, 248.0631425526789, 99.24493654534503, 226.2320449162667, 75.11682524682027, 166.702447469176, 360.0658583631545, 324.6446502413099, 376.2097843976688, 366.4788101768074, 210.6977478743174, 278.2190839327695, 114.3385329660097, 293.2795285426073, 196.7923459779239]
}

df = pd.DataFrame(data)

x = df[["Inversión en publicidad (USD)"]]
y = df[["Ventas (unidades)"]]
model = LinearRegression()
model.fit(x, y)

def calculate_prediction(investment):
    investment_df = pd.DataFrame([[investment]], columns=["Inversión en publicidad (USD)"])
    result = model.predict(investment_df)[0][0]
    return round(result, 2)

def generate_plot():
    plt.figure(figsize=(6, 4))
    plt.scatter(df["Inversión en publicidad (USD)"], df["Ventas (unidades)"], color='blue', label="Datos")
    plt.plot(df["Inversión en publicidad (USD)"], model.predict(x), color='red', linewidth=2, label="Regresión Lineal")
    plt.xlabel("Inversión en publicidad (USD)")
    plt.ylabel("Ventas (unidades)")
    plt.title("Regresión Lineal: Publicidad vs. Ventas")
    plt.legend()
    
    img = io.BytesIO()
    plt.savefig(img, format='png')
    img.seek(0)
    plot_url = base64.b64encode(img.getvalue()).decode()
    plt.close()
    return plot_url

